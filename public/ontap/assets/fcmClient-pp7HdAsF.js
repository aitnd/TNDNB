import{r as t,C as n,d as a,b as c,u as d,c as l}from"./index-BsloeK7v.js";const o=t("PushNotifications",{}),g=async s=>{if(!n.isNativePlatform()){console.log("FCM: Not a native platform, skipping.");return}console.log("FCM: Initializing...");const i=await o.checkPermissions();if(i.receive==="prompt"){if((await o.requestPermissions()).receive!=="granted"){console.error("FCM: User denied permissions");return}}else if(i.receive!=="granted"){console.error("FCM: Permissions not granted");return}await o.register(),o.addListener("registration",async e=>{console.log("FCM: Token received:",e.value);try{const r=a(c,"users",s);await d(r,{fcmTokens:l(e.value),lastFcmUpdate:new Date}),console.log("FCM: Token saved to Firestore")}catch(r){console.error("FCM: Error saving token:",r)}}),o.addListener("registrationError",e=>{console.error("FCM: Registration failed:",e)}),o.addListener("pushNotificationReceived",e=>{console.log("FCM: Received foreground notification:",e)}),o.addListener("pushNotificationActionPerformed",e=>{console.log("FCM: Action performed:",e.actionId,e.inputValue)})};export{g as initializeFCM};
